@model MakeSheduleView
@{
    ViewData["Title"] = "Timetables";
}

<div class="div_reg2_1 flex" style="justify-content:space-around">


    <div style="padding-top:15px;">
        <a class="btn btn-outline-dark buttonsGY" style="padding:2px;border-radius:1px;min-width:120px;text-align:center;max-height:30px;" asp-area="" asp-controller="Time" asp-action="BackToRooms" class="btn btn-primary padd1 buttons1">@Resources.Resource.Back</a>
    </div>
    <div class="flex" style="flex-direction:column;">
    <div class="flex">
        <div style="min-width:40px;max-width:40px;max-height:7px;background-color:#a758bf;margin:5px;"></div>
            <div class="whiteY">Индивидуальные тренировки</div>
    </div>
        <div class="flex">
            <div style="min-width:40px;max-width:40px;max-height:7px;background-color:coral;margin:5px;"></div>
            <div class="whiteY">Групповые тренировки</div>
        </div>
    </div>
    <input type="hidden" id="idshed" value="@Model.room.sheduleId" />
    <input type="hidden" id="idroom" value="@Model.room.Id" />
    <h1 class="whiteY">@Model.room.Name &nbsp;&nbsp;&nbsp;</h1>
     <img src="@Model.room.Photo" style="width:100px;height:auto" alt="photo" />    

    @if (Model.message == null)
    {
        <div style="padding-top:15px;">
        <a href="javascript:void(0)" id="btnDelShed" class="btn btn-outline-dark buttonsGY" style="padding:2px;border-radius:1px;min-width:120px;max-height:30px;text-align:center; ">
           @Resources.Resource.Delete&nbsp;&nbsp;@Resources.Resource.Shedule

        </a>
        </div>
    }
</div>
@if (Model.message == null)
{

    <div class="div_reg2_1">
                @for (var t1 = 0; t1 < Model.times.Count; t1++)
                {
         <div class="flex " style=" border:2px solid dimgray">
             <div class="flex" style="flex-direction:column;justify-content:center">
            @if (t1 == 0)
            {
                <div style="min-width:200px">
                    <h6 class="padd whiteY marg div_reg2_1" style="text-align:center;">Понедельник</h6>
                </div>
            }
            @if (t1 == 1)
            {
                    <div style="min-width:200px">
                    <h6 class="padd whiteY marg div_reg2_1" style="text-align:center;">Вторник</h6>
                </div>
            }
            @if (t1 == 2)
            {
                    <div style="min-width:200px">
                    <h6 class="padd whiteY marg div_reg2_1" style="text-align:center;">Среда</h6>
                </div>
            }
              @if (t1 == 3)
            {
                    <div style="min-width:200px">
                    <h6 class="padd whiteY marg div_reg2_1" style="text-align:center;">Четверг</h6>
                </div >
            }
              @if (t1 == 4)
            {
                    <div style="min-width:200px">
                    <h6 class="padd whiteY marg div_reg2_1" style="text-align:center;">Пятница</h6>
                </div>
            }
              @if (t1 == 5)
            {
                    <div style="min-width:200px">
                    <h6 class="padd whiteY marg div_reg2_1" style="text-align:center;">Суббота</h6>
                </div>
            }
            @if (t1 == 6)
            {
                    <div style="min-width:200px">
                    <h6 class="padd whiteY marg div_reg2_1" style="text-align:center;">Воскресенье</h6>
                </div>
            }

                </div>


                <div class="flex " style="flex-wrap:wrap; border:2px solid dimgray">
        
                     @for (var t = 0; t < Model.times[t1].Times.Count; t++)
                     {
                        <div>
                            <form method="post" class="padd marg div_reg2_1" style="min-width:200px;min-height:200px;">

                                <input type="hidden" name="day" value="@t1" />
                                <input type="hidden" name="roomId" value="@Model.room.Id" />
                                <input type="hidden" name="roomName" value="@Model.room.Name" />

                                <div class="flex" style="justify-content:center;"> <input type="text" name="time" value="@Model.times[t1].Times[t]" style="width:120px; background-color:#F0E68C;" readonly> </div>


                                @foreach (var it in Model.trainingInd)
                                {
                                    @if (@Model.times[t1].Times[t] != "Выходной" && @it.Time == @Model.times[t1].Times[t] && @it.Day == @t1 && it.RoomId == @Model.room.Id)
                                    {
                                    { Model.flag = true; }

                                        <div class="flex" style="width:150px;height:160px;overflow-x: auto; overflow-y: hidden; white-space: nowrap;">
                                            <div style="min-width:150px;min-height:150px;">
                                                <div style="min-width:20px;max-width:20px;min-height:6px;background-color:#a758bf;"></div>
                                                <div >
                                               
                                                <span class="whiteY">Тренер : </span><br />
                                                <span class="whiteY">@it.CoachName</span><br />
                                                @if(it.UserId == null)
                                                {
                                                        <a class="btn btn-outline-dark buttonsGY"  asp-area="" asp-route-Id="@it.Id" asp-controller="TrainingInd" asp-action="AddUserToTrainingInd">Записать</a>
                                                   
                                                }
                                                else
                                                {
                                                       
                                                    <span class="whiteY">Клиент:</span><br />
                                                     <span class="whiteY">@it.UserName</span>
                                                        <br />
                                                        <a class="btn btn-outline-dark buttonsGY" style="padding:2px;border-radius:1px;min-width:120px;text-align:center;" asp-area="" asp-route-Id="@it.Id" asp-controller="TrainingInd" asp-action="UpdateTraining">@Resources.Resource.Edit</a>
                                                       
                                                }
                                                </div>
                                            </div>
                                            <div style="width:150px;height:150px;">
                                            <img src="@it.CoachPhoto" style="width:150px;height:auto" alt="photo" class="marg" />
                                            </div>
                                        </div>
                                    }
                                }
                                @foreach (var it in Model.traininggroup)
                                {
                                    @if (@Model.times[t1].Times[t] != "Выходной" && @it.Time == @Model.times[t1].Times[t] && @it.Day == @t1 && it.Room.Id == @Model.room.Id)
                                    {
                                    { Model.flag = true; }
                                    <div class="flex" style="width:150px;height:160px;overflow-x: auto; overflow-y: hidden; white-space: nowrap;">
                                           
                                            <div style="min-width:150px;min-height:150px;">
                                                <div style="min-width:20px;max-width:20px;min-height:6px;background-color:coral;"></div>
                                                <div style="width:100%;height:100%">
                                                @{
                                                    var num = it.Number - it.Users.Count;
                                                }
                                            
                                          
                                                <span class="whiteY">Тренер : </span><br />
                                                <span class="whiteY">@it.Coach.Name</span><br />
                                                @if (it.Number > it.Users.Count)
                                                {<span class="whiteY">Доступно : @num </span><br />
                                                    <div class="flex" style="flex-wrap:wrap;">
                                                        <div class="marg">
                                                            <a class="btn btn-outline-dark buttonsGY" style="padding:2px;border-radius:1px;min-width:120px;text-align:center;" asp-area="" asp-route-roomId="@it.Room.Id" asp-route-trgroupId="@it.Id" asp-controller="Users" asp-action="AddUsersToTrainingGroup">Записать</a>
                                                            </div> <div class="marg">
                                                                <a class="btn btn-outline-dark buttonsGY" style="padding:2px;border-radius:1px;min-width:120px;text-align:center;" asp-area="" asp-route-Id="@it.Id" asp-controller="Time" asp-action="DetailsTrainingGroup">@Resources.Resource.Edit</a>
                                                    </div>
                                                     </div>
                                                    
                                                }
                                                else
                                                {
                                                    <span class=" whiteY"> заполнена</span>
                                                        <div>
                                                            <a class="btn btn-outline-dark  buttonsGY butcoral" asp-area="" asp-route-Id="@it.Id" asp-controller="Time" asp-action="DetailsTrainingGroup">@Resources.Resource.Edit</a>
                                                        </div>
                                                }
                                                </div>
                                            </div>
                                            @if (it.Users.Count > 0)
                                            {                             
                                                <div class="flex" style="min-width:150px;min-height:150px;flex-direction:column;overflow:scroll;justify-content:center;">
                                                    <div class="whiteY" style="text-align:center;">Клиенты:</div>
                                                    @foreach (var a in it.Users)
                                                    {
                                                        <div class="whiteY" style="text-align:center;" >@a.Name</div>
                                                       
                                                    }
                                                </div>
                                            }
                                            <div style="width:150px;height:150px;">
                                                <img src="@it.Coach.Photo" style="width:150px;height:auto;" alt="photo" class="marg" />
                                            </div>
                                        </div>
                                    }
                                }

                                @if (@Model.times[t1].Times[t] != "Выходной" && !@Model.flag)
                                {
                                    <div class="flex" style=" min-width:150px;min-height:160px;flex-direction:column;justify-content:space-around" >
                                        <div><span class="whiteY">индивидуальная</span><br />
                                            <input class="buttonsGY" type="submit" formaction="AddIndTraining" value="@Resources.Resource.Add" />
                                        </div>
                                      
                                        <div>
                                            <span class="whiteY">групповая</span><br />
                                            <input class="buttonsGY" type="submit" formaction="AddTrainingGroup" value="@Resources.Resource.Add" />
                                        </div>
                                    </div>

                                }

                   
                            </form>

                          @{ Model.flag = false;}
                    </div>
                }
           </div>

            </div>
           }
     </div>

     
}
@if (Model.message != null)
{
    <div class="center">
        <div style="display:flex;flex-direction:column;">
            <div>
                <h1>@Model.message</h1><div style="display:flex;flex-direction:column;">
                </div><br /><br />
                <div>
                    <form method="post">

                        <input type="hidden" name="Id" value="@Model.room.Id" />
                        <input type="submit" asp-controller="Time" asp-action="GetAllTimetable" class="padd1 white" value="Составить расписание зала" />

                    </form>
                </div>
            </div>
        </div>
    </div>
}

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
    $(document).ready(function () {

        $("#btnDelShed").click(function () {
            // var idS = $("#idshed").val();
            var idR = $("#idroom").val();
            var puth = "/Time/DeleteShedule/?RomId=" + idR;
            $("<div id='dialogContent3'></div>")
                .addClass("dialog")
                .appendTo("body")
                .load(puth)
                .dialog({
                    title: "Подтвердите!",
                    close: function () { $(this).remove(); },
                    dialogClass: 'myTitleClass',
                    modal: true,
                    resizable: false,
                    buttons: [{
                        class: "input_subm2",
                        text: "Удалить",
                        click: function () {
                            $.ajax({
                                url: "@Url.Action("DeleteSheduleInRoom", "Time")",
                                type: "POST",
                                data: { RomId: idR },
                                datatype: "json",
                                success: function (response) {

                                    if (response) {

                                        window.location.href = "@Url.Action("Room_Shedule", "Time")";
                                    }
                                }
                            });
                        }
                    }],
                    open: function (event, ui) {
                        StyleDialog($(this).closest(".ui-dialog"));
                    }
                });

        });

        function StyleDialog(dialog) {
            dialog
                .find(".ui-dialog-titlebar")
                .css({
                    "background-color": "#374566", // Фон заголовка
                    "color": "white" // Цвет текста заголовка black
                });
            dialog
                .css({
                    "box-shadow": "inset 0 - 3em 3em rgba(0, 0, 0, 0.1), 0.3em 0.3em 1em black",
                    "border-radius": "10px",
                    "border": "solid 1px #374566",
                    "background-color": "#374566"
                });
            dialog
                .find(".ui-dialog-content")
                .css({
                    "background-color": "#374566"
                });
            dialog
                .find(".ui-widget-content")
                .css({
                    "border": "none",
                    "background-color": "#374566"
                });
            dialog
                .find(".ui-dialog-buttonpane")
                .css({
                    "border-width": "0px",
                    "background-color": "#374566"
                });
        }
    });
</script>